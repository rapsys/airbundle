#RapsysAir configuration
rapsys_air:

#RapsysUser configuration
rapsys_user:
    #Class replacement
    class:
        group: 'Rapsys\AirBundle\Entity\Group'
        civility: 'Rapsys\AirBundle\Entity\Civility'
        user: 'Rapsys\AirBundle\Entity\User'
        country: 'Rapsys\AirBundle\Entity\Country'
    #Default replacement
    default:
        group: [ 'User' ]
        civility: 'Mister'
        country: 'France'
        country_favorites: [ 'France', 'Belgium', 'Germany', 'Italy', 'Luxembourg', 'Portugal', 'Spain', 'Switzerland' ]
    #Route replacement
    route:
        index:
            name: 'rapsys_air'
    #Translate replacement
    translate: [ 'title', 'password', 'site.title', 'copy.by', 'copy.long', 'copy.short', 'copy.title' ]
    #Languages replacement
    languages:
        en_gb: 'English'
        fr_fr: 'French'
    #Contact replacement
    contact:
        title: '%rapsys_air.contact.title%'
        mail: '%rapsys_air.contact.mail%'
    #Context replacement
    context:
        copy:
            by: '%rapsys_air.copy.by%'
            link: '%rapsys_air.copy.link%'
            long: '%rapsys_air.copy.long%'
            short: '%rapsys_air.copy.short%'
            title: '%rapsys_air.copy.title%'
        site:
            icon: '%rapsys_air.site.icon%'
            logo: '%rapsys_air.site.logo%'
            png: '%rapsys_air.site.png%'
            title: '%rapsys_air.site.title%'
            url: '%rapsys_air.site.url%'
    #Edit replacement
    edit:
        field:
            pseudonym: false
        route:
            index: 'site.url'
        view:
            edit: 'Rapsys\AirBundle\Form\RegisterType'
            name: '@RapsysAir/form/edit.html.twig'
            context:
                title: 'Modify account'
                password: 'Modify password'
    #Login replacement
    login:
        route:
            index: 'site.url'
        view:
            name: '@RapsysAir/form/login.html.twig'
            context:
                title: 'Login'
    #Recover replacement
    recover:
        route:
            index: 'site.url'
            recover: 'recover_url'
        view:
            name: '@RapsysAir/form/recover.html.twig'
            context:
                title: 'Recover'
        mail:
            subject: 'Welcome back %%recipient_name%% to %%site.title%%'
            html: '@RapsysAir/mail/recover.html.twig'
            text: '@RapsysAir/mail/recover.text.twig'
            context:
    #Register replacement
    register:
        field:
            city: false
            country: false
            phone: false
            pseudonym: false
            zipcode: false
        route:
            index: 'site.url'
            confirm: 'confirm_url'
        view:
            form: 'Rapsys\AirBundle\Form\RegisterType'
            name: '@RapsysAir/form/register.html.twig'
            context:
                title: 'Register'
        mail:
            subject: 'Welcome %%recipient_name%% to %%site.title%%'
            html: '@RapsysAir/mail/register.html.twig'
            text: '@RapsysAir/mail/register.text.twig'
            context:

#Doctrine configuration
doctrine:
    #Dbal configuration
    dbal:
        mapping_types:
            enum: string

    #Orm configuration
    orm:
        #Replace repository factory
        repository_factory: 'Rapsys\AirBundle\Factory\RepositoryFactory'

        #Force resolution of UserBundle entities to AirBundle one
        #XXX: without these lines, relations are lookup in parent namespace ignoring AirBundle extension
        resolve_target_entities:
            Rapsys\UserBundle\Entity\Group: 'Rapsys\AirBundle\Entity\Group'
            Rapsys\UserBundle\Entity\Civility: 'Rapsys\AirBundle\Entity\Civility'
            Rapsys\UserBundle\Entity\User: 'Rapsys\AirBundle\Entity\User'

#Security configuration
security:
    #Enable authenticator manager
    enable_authenticator_manager: true

    #Set password hashers
    password_hashers:
        #Rapsys\AirBundle\Entity\User: plaintext
        Rapsys\AirBundle\Entity\User:
            algorithm: 'bcrypt'

    #Set providers
    providers:
        database:
            entity:
                class: Rapsys\AirBundle\Entity\User
                property: mail

    #Set firewall
    firewalls:
        #Disables authentication for assets and the profiler, adapt it according to your needs
        dev:
            pattern: ^/(_(profiler|wdt)|css|images|js)/
            security: false

        main:
            #Allow anonymous access
            #anonymous: ~
            #lazy: true

            #Activate database provider
            provider: database

            #XXX: https://symfony.com/doc/current/security.html#a-configuring-how-your-users-will-authenticate
            #http_basic: ~

            #Set form login
            #XXX: https://symfony.com/doc/current/security/form_login_setup.html
            #TODO: https://symfony.com/doc/current/security/guard_authentication.html
            form_login:
                #Redirect to referer if different from login route
                use_referer: true
                #Login path
                login_path: rapsys_user_login
                #Check path
                check_path: rapsys_user_login
                #Username parameter
                username_parameter: 'login[mail]'
                #Password parameter
                password_parameter: 'login[password]'

            #Set logout route
            logout:
                #Logout route
                path: rapsys_user_logout
                #Logout default target
                target: rapsys_air

            #Set custom access denied handler
            access_denied_handler: Rapsys\AirBundle\Handler\AccessDeniedHandler

            #Remember me
            #XXX: see https://symfony.com/doc/current/security/remember_me.html
            remember_me:
                #Use APP_SECRET
                secret: '%kernel.secret%'
                #Always remember me
                always_remember_me: true

    #Set role hierarchy
    role_hierarchy:
        ROLE_GUEST: [ 'ROLE_USER' ]
        ROLE_REGULAR: [ 'ROLE_USER', 'ROLE_GUEST' ]
        ROLE_SENIOR: [ 'ROLE_USER', 'ROLE_GUEST', 'ROLE_REGULAR' ]
        ROLE_ADMIN: [ 'ROLE_USER', 'ROLE_GUEST', 'ROLE_REGULAR', 'ROLE_SENIOR' ]

#Framework configuration
framework:
    default_locale: 'fr_fr'
    #error_controller: 'Rapsys\AirBundle\Controller\ErrorController::show'
    translator:
        fallbacks: [ 'fr_fr', 'en_gb' ]
    session:
        enabled: true
        handler_id: ~
        storage_factory_id: 'session.storage.factory.native'
        cookie_secure: 'auto'
        cookie_samesite: 'lax'
    disallow_search_engine_index: false
    mailer:
        headers:
            X-Originating-IP: '%env(REMOTE_ADDR)%'
    secret: '%env(APP_SECRET)%'
#framework:
#    error_controller: Rapsys\AirBundle\Controller\ErrorController::show
#
#    #Assets configuration
#    XXX: don't use that shit, it breaks assets._default_package url generation
#    assets:
#        #Set default base path
#        #base_path: '/bundles/%%s'
#        #Set default version
#        version: 'x'
#        #Set default format
#        version_format: '%%s?v=%%s'
#
#        packages:
#            pack:
#                base_path: '/bundles/%%s'

#Service configuration
services:
    #Register twig file_get_contents extension
    #XXX: obsolete by email.image twig filter in "twig/extensions" or "twig/html-extra"
    #rapsys_air.twig.file_get_contents:
    #    class: 'Rapsys\AirBundle\Twig\FileGetContentsExtension'
    #    tags: [ 'twig.extension' ]
    #Register twig base64 extension
    #rapsys_air.twig.base64:
    #    class: 'Rapsys\AirBundle\Twig\Base64Extension'
    #    tags: [ 'twig.extension' ]
    #Register twig bb2html extension
    #rapsys_air.twig.bb2html:
    #    class: 'Rapsys\AirBundle\Twig\Bb2htmlExtension'
    #    tags: [ 'twig.extension' ]
    #Register twig intl extension
    #XXX: https://www.php.net/manual/en/class.intldateformatter.php
    #XXX: https://stackoverflow.com/questions/25948853/how-to-install-the-intl-extension-for-twig
    #rapsys_air.twig.intl:
    #    class: 'Twig\Extensions\IntlExtension'
    #    tags: [ 'twig.extension' ]
    #new TwigFilter('markdown_to_html', ['Twig\\Extra\\Markdown\\MarkdownRuntime', 'convert'], ['is_safe' => ['all']]),
    #new TwigFilter('html_to_markdown', 'Twig\\Extra\\Markdown\\twig_html_to_markdown', ['is_safe' => ['all']]),
    #Register twig markdown_to_html extension
    #    #class: 'Twig\Extra\Markdown\DefaultMarkdown'
    #rapsys_air.twig.markdown_eruse:
    #    class: 'Twig\Extra\Markdown\DefaultMarkdown'
    #rapsys_air.twig.markdown_runtime:
    #    class: 'Twig\Extra\Markdown\MarkdownRuntime'
    #    arguments: [ '@rapsys_air.twig.markdown_eruse' ]
    #rapsys_air.markdown:
    #    class: 'Twig\Extra\Markdown\MarkdownExtension'
    #    tags: [ 'twig.extension' ]
    #Register twig pack extension
    #rapsys_pack.pack_extension:
    #    class: 'Rapsys\PackBundle\Twig\PackExtension'
    #    arguments: [ '@file_locator', '@service_container', '@rapsys_pack.path_package' ]
    #    tags: [ 'twig.extension' ]
    #Register application controller
    Rapsys\AirBundle\Controller\ApplicationController:
        arguments: [ '@security.authorization_checker', '@service_container', '@rapsys_user.access_decision_manager', '@doctrine', '@rapsys_air.facebook_util', '@form.factory', '@rapsys_pack.image_util', '@mailer.mailer', '@doctrine.orm.default_entity_manager', '@rapsys_pack.map_util', '@rapsys_pack.path_package', '@router', '@rapsys_pack.slugger_util', '@request_stack', '@translator' ]
        tags: [ 'controller.service_arguments' ]
    #Register calendar controller
    Rapsys\AirBundle\Controller\CalendarController:
        arguments: [ '@security.authorization_checker', '@service_container', '@rapsys_user.access_decision_manager', '@doctrine', '@rapsys_air.facebook_util', '@form.factory', '@rapsys_pack.image_util', '@mailer.mailer', '@doctrine.orm.default_entity_manager', '@rapsys_pack.map_util', '@rapsys_pack.path_package', '@router', '@rapsys_pack.slugger_util', '@request_stack', '@translator' ]
        tags: [ 'controller.service_arguments' ]
    #Register default controller
    Rapsys\AirBundle\Controller\DefaultController:
        arguments: [ '@security.authorization_checker', '@service_container', '@rapsys_user.access_decision_manager', '@doctrine', '@rapsys_air.facebook_util', '@form.factory', '@rapsys_pack.image_util', '@mailer.mailer', '@doctrine.orm.default_entity_manager', '@rapsys_pack.map_util', '@rapsys_pack.path_package', '@router', '@rapsys_pack.slugger_util', '@request_stack', '@translator' ]
        tags: [ 'controller.service_arguments' ]
    #Register dance controller
    Rapsys\AirBundle\Controller\DanceController:
        arguments: [ '@security.authorization_checker', '@service_container', '@rapsys_user.access_decision_manager', '@doctrine', '@rapsys_air.facebook_util', '@form.factory', '@rapsys_pack.image_util', '@mailer.mailer', '@doctrine.orm.default_entity_manager', '@rapsys_pack.map_util', '@rapsys_pack.path_package', '@router', '@rapsys_pack.slugger_util', '@request_stack', '@translator' ]
        tags: [ 'controller.service_arguments' ]
    #Register location controller
    Rapsys\AirBundle\Controller\LocationController:
        arguments: [ '@security.authorization_checker', '@service_container', '@rapsys_user.access_decision_manager', '@doctrine', '@rapsys_air.facebook_util', '@form.factory', '@rapsys_pack.image_util', '@mailer.mailer', '@doctrine.orm.default_entity_manager', '@rapsys_pack.map_util', '@rapsys_pack.path_package', '@router', '@rapsys_pack.slugger_util', '@request_stack', '@translator' ]
        tags: [ 'controller.service_arguments' ]
    #Register organizer controller
    Rapsys\AirBundle\Controller\OrganizerController:
        arguments: [ '@security.authorization_checker', '@service_container', '@rapsys_user.access_decision_manager', '@doctrine', '@rapsys_air.facebook_util', '@form.factory', '@rapsys_pack.image_util', '@mailer.mailer', '@doctrine.orm.default_entity_manager', '@rapsys_pack.map_util', '@rapsys_pack.path_package', '@router', '@rapsys_pack.slugger_util', '@request_stack', '@translator' ]
        tags: [ 'controller.service_arguments' ]
    #Register user controller
    Rapsys\AirBundle\Controller\UserController:
        arguments: [ '@service_container', '@doctrine', '@security.user_password_hasher', '@logger', '@mailer.mailer', '@doctrine.orm.default_entity_manager', '@router', '@rapsys_pack.slugger_util', '@request_stack', '@translator' ]
        tags: [ 'controller.service_arguments' ]
    #Register session controller
    Rapsys\AirBundle\Controller\SessionController:
        arguments: [ '@security.authorization_checker', '@service_container', '@rapsys_user.access_decision_manager', '@doctrine', '@rapsys_air.facebook_util', '@form.factory', '@rapsys_pack.image_util', '@mailer.mailer', '@doctrine.orm.default_entity_manager', '@rapsys_pack.map_util', '@rapsys_pack.path_package', '@router', '@rapsys_pack.slugger_util', '@request_stack', '@translator' ]
        tags: [ 'controller.service_arguments' ]
    #Register snippet controller
    Rapsys\AirBundle\Controller\SnippetController:
        arguments: [ '@security.authorization_checker', '@service_container', '@rapsys_user.access_decision_manager', '@doctrine', '@rapsys_air.facebook_util', '@form.factory', '@rapsys_pack.image_util', '@mailer.mailer', '@doctrine.orm.default_entity_manager', '@rapsys_pack.map_util', '@rapsys_pack.path_package', '@router', '@rapsys_pack.slugger_util', '@request_stack', '@translator' ]
        tags: [ 'controller.service_arguments' ]
    #Register error controller
    Rapsys\AirBundle\Controller\ErrorController:
        arguments: [ '@security.authorization_checker', '@service_container', '@rapsys_user.access_decision_manager', '@doctrine', '@rapsys_air.facebook_util', '@form.factory', '@rapsys_pack.image_util', '@mailer.mailer', '@doctrine.orm.default_entity_manager', '@rapsys_pack.map_util', '@rapsys_pack.path_package', '@router', '@rapsys_pack.slugger_util', '@request_stack', '@translator' ]
        #arguments: [ '@service_container', '@router', '@translator' ]
        tags: [ 'controller.service_arguments' ]
    #Register locale event subscriber
    #TODO: remove that shit now ???
    #Rapsys\AirBundle\EventSubscriber\LocaleSubscriber:
    #    arguments: [ '@router', '%rapsys_air.locales%' ]
    #    tags: [ 'kernel.event_subscriber' ]
    #Register access denied handler
    Rapsys\AirBundle\Handler\AccessDeniedHandler:
        arguments: [ '@security.authorization_checker', '@service_container', '@rapsys_user.access_decision_manager', '@doctrine', '@rapsys_air.facebook_util', '@form.factory', '@rapsys_pack.image_util', '@mailer.mailer', '@doctrine.orm.default_entity_manager', '@rapsys_pack.map_util', '@rapsys_pack.path_package', '@router', '@rapsys_pack.slugger_util', '@request_stack', '@translator' ]
    #Register air fixtures
    Rapsys\AirBundle\DataFixtures\AirFixtures:
        tags: [ 'doctrine.fixture.orm' ]
#   #Set version strategy
#   assets.static_version_strategy:
#       class: Symfony\Component\Asset\VersionStrategy\StaticVersionStrategy
#       arguments: [ 'x', '%%s?v=%%s' ]
    Rapsys\AirBundle\Form\ApplicationType:
        arguments: [ '@doctrine', '@translator' ]
        tags: [ 'form.type' ]
    Rapsys\AirBundle\Form\LocationType:
        tags: [ 'form.type' ]
    Rapsys\AirBundle\Form\SessionType:
        arguments: [ '@doctrine' ]
        tags: [ 'form.type' ]
    Rapsys\AirBundle\Form\Extension\Type\HiddenEntityType:
        arguments: [ '@doctrine' ]
        tags: [ 'form.type' ]
    Rapsys\AirBundle\Form\ContactType:
        arguments: [ '@rapsys_pack.image_util', '@rapsys_pack.slugger_util', '@translator' ]
        tags: [ 'form.type' ]
    Rapsys\AirBundle\Command\AttributeCommand:
        arguments: [ '@doctrine' ]
        tags: [ 'console.command' ]
    Rapsys\AirBundle\Command\CalendarCommand:
        arguments: [ '@doctrine', '@router', '@rapsys_pack.slugger_util', '@translator', 'airlibre', 0, '%kernel.project_dir%/var/cache', '%kernel.default_locale%' ]
        tags: [ 'console.command' ]
    Rapsys\AirBundle\Command\RekeyCommand:
        arguments: [ '@doctrine' ]
        tags: [ 'console.command' ]
    Rapsys\AirBundle\Command\WeatherCommand:
        arguments: [ '@doctrine', '@filesystem' ]
        tags: [ 'console.command' ]
    Rapsys\AirBundle\Factory\RepositoryFactory:
        arguments: [ '@router', '@rapsys_pack.slugger_util', '@translator', '%rapsys_air.languages%' ]
    #Register facebook util service
    rapsys_air.facebook_util:
        class: 'Rapsys\PackBundle\Util\FacebookUtil'
        arguments: [ '@router',  '%kernel.project_dir%/var/cache', '%rapsys_pack.path%', 'facebook', '%rapsys_air.path%/png/facebook.png', { irishgrover: '%rapsys_air.path%/ttf/irishgrover.v10.ttf', labelleaurore: '%rapsys_air.path%/ttf/labelleaurore.v10.ttf', dejavusans: '%rapsys_air.path%/ttf/dejavusans.2.37.ttf', droidsans: '%rapsys_air.path%/ttf/droidsans.regular.ttf' } ]
        public: true

#Twig Configuration
twig:
    #Enforce debug
    #debug: true
    #auto_reload: ~
    #Disable cache
    #XXX: enable forced regeneration of css and js at each page load
    cache: false
    #Fix form layout for css
    #XXX: @RapsysAir is a shortcut to vendor/rapsys/airbundle/Resources/views directory here
    form_theme: [ '@RapsysAir/form/form_div_layout.html.twig' ]
    #Set twig paths
    paths:
        #Required by email.image(site_logo) directive
        #XXX: Allow twig to resolve @RapsysAir/png/logo.png in vendor/rapsys/airbundle/Resources/public/png/logo.png
        '%kernel.project_dir%/vendor/rapsys/airbundle/Resources/public': 'RapsysAir'
    #Override default exception controller
    #exception_controller: Rapsys\AirBundle\Controller\ErrorController::preview
